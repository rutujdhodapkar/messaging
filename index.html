<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Chat</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #messagesList { margin-top: 10px; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>WebRTC Chat</h1>
    <input type="text" id="peerIdInput" placeholder="Enter Peer ID" />
    <button id="connectButton">Connect</button>
    <input type="text" id="messageInput" placeholder="Type your message..." />
    <button id="sendButton">Send</button>
    <ul id="messagesList"></ul>

    <script>
        const peerIdInput = document.getElementById('peerIdInput');
        const connectButton = document.getElementById('connectButton');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const messagesList = document.getElementById('messagesList');

        let localConnection;
        let remoteConnection;
        let sendChannel;
        
        // Create a new peer connection
        function createConnection() {
            localConnection = new RTCPeerConnection();
            sendChannel = localConnection.createDataChannel('sendChannel');
            sendChannel.onopen = () => console.log('Send channel opened');
            sendChannel.onclose = () => console.log('Send channel closed');

            localConnection.onicecandidate = e => {
                if (e.candidate) {
                    // Send the candidate to the remote peer (you need a signaling mechanism)
                    console.log('ICE candidate', e.candidate);
                }
            };

            localConnection.ondatachannel = event => {
                const receiveChannel = event.channel;
                receiveChannel.onmessage = e => {
                    const li = document.createElement('li');
                    li.textContent = `Peer: ${e.data}`;
                    messagesList.appendChild(li);
                };
            };
        }

        // Connect to the peer with the given ID
        connectButton.addEventListener('click', () => {
            createConnection();
            const peerId = peerIdInput.value;

            // Here, you would typically send an offer to the other peer using your signaling method
            localConnection.createOffer()
                .then(offer => {
                    return localConnection.setLocalDescription(offer);
                })
                .then(() => {
                    console.log('Offer sent to peer:', localConnection.localDescription);
                    // Send offer to the remote peer (you need to implement this part)
                })
                .catch(error => console.error('Error creating offer:', error));
        });

        // Send message to the connected peer
        sendButton.addEventListener('click', () => {
            const message = messageInput.value;
            if (sendChannel && sendChannel.readyState === 'open') {
                sendChannel.send(message);
                const li = document.createElement('li');
                li.textContent = `You: ${message}`;
                messagesList.appendChild(li);
                messageInput.value = ''; // Clear input
            } else {
                alert('Connection not established or channel not open');
            }
        });

        // Function to handle incoming offers and set up connection
        function handleIncomingOffer(offer) {
            remoteConnection = new RTCPeerConnection();
            remoteConnection.onicecandidate = e => {
                if (e.candidate) {
                    console.log('Remote ICE candidate', e.candidate);
                }
            };

            remoteConnection.ondatachannel = event => {
                const receiveChannel = event.channel;
                receiveChannel.onmessage = e => {
                    const li = document.createElement('li');
                    li.textContent = `Peer: ${e.data}`;
                    messagesList.appendChild(li);
                };
            };

            remoteConnection.setRemoteDescription(offer)
                .then(() => remoteConnection.createAnswer())
                .then(answer => {
                    return remoteConnection.setLocalDescription(answer);
                })
                .then(() => {
                    console.log('Answer sent to peer:', remoteConnection.localDescription);
                    // Send answer back to the original peer (you need to implement this part)
                })
                .catch(error => console.error('Error handling offer:', error));
        }

        // Function to receive remote offer (this would be called when you receive an offer)
        // handleIncomingOffer(remoteOffer); // Example call with an offer

    </script>
</body>
</html>
